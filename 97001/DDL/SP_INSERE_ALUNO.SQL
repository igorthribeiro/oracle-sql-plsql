create or replace PROCEDURE SP_INSERE_ALUNO(P_NM_NOME ALUNO.NM_NOME%TYPE,
                                 P_DS_EMAIL ALUNO.DS_EMAIL%TYPE)
IS
   E_EMAIL_INVALIDO EXCEPTION;
   E_NOME_NULO EXCEPTION;
   PRAGMA EXCEPTION_INIT(E_NOME_NULO, -01400);
   
   V_CD_ALUNO ALUNO.CD_ALUNO%TYPE;
   V_NM_MATRICULA ALUNO.NM_MATRICULA%TYPE;
BEGIN
   IF NOT FC_VALIDA_EMAIL(P_DS_EMAIL) THEN
      RAISE E_EMAIL_INVALIDO;
   END IF;

   IF TRIM(P_NM_NOME) IS NULL THEN
      RAISE E_NOME_NULO;
   END IF;

   --PEGAR O CÓDIGO
   V_CD_ALUNO := SQ_CD_ALUNO.NEXTVAL;
   --GERA O NÚMERO DA MATRICULA
   V_NM_MATRICULA := FC_GERA_MATRICULA(V_CD_ALUNO);

   INSERT INTO ALUNO (CD_ALUNO, NM_MATRICULA, NM_NOME, DS_EMAIL)
          VALUES(V_CD_ALUNO, V_NM_MATRICULA, P_NM_NOME, P_DS_EMAIL);

   EXCEPTION 
      WHEN E_EMAIL_INVALIDO THEN
         DBMS_OUTPUT.PUT_LINE('E-MAIL INVÁLIDO!');
      WHEN E_NOME_NULO THEN
         DBMS_OUTPUT.PUT_LINE('NOME NÃO PODE SER NULO');
      WHEN OTHERS THEN
         DBMS_OUTPUT.PUT_LINE('ERRO DESCONHECIDO. FALE COM O SUPORTE!');
END;